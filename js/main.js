"use strict";function doLogin(a,b,c){fb.authWithPassword({email:a,password:b},function(a,b){a?alert(a.toString()):(saveAuthData(b),"function"==typeof c&&c(b))})}function saveAuthData(a){var b=fb.child("/users/"+a.uid+"/profile");b.set(a)}function clearLoginForm(){$('.login input[type="email"]').val(""),$('.login input[type="password"]').val("")}function userMovies(a){if(a){var b=Object.keys(a)[0];saveMovieToDiv(a[b],b)}}function addMovieToDiv(a){$divContain.empty(),$divContain.append(createMovieNode(a))}function createMovieNode(a){var b=$("<div></div>");b.addClass("movie");var c=$("<img src='"+a.Poster+"'></img>");c.attr("class","col-md-6");var d=$("<h3>"+a.Title+"</h3>"),e=$("<h4>"+a.Year+"</h4>"),f=$("<p>"+a.Genre+"</p>"),g=$("<p>"+a.imdbRating+"</p>");return b.append(c,d,e,f,g),b}function saveMovieToDiv(a,b){$divTable.append(createMovieTable(a,b))}function createMovieTable(a,b){var c=$("<tr></tr>");c.attr("data-id",b),c.attr("class","movie_row");var d=$("<td><img class='small_poster' src='"+a.Poster+"'></img></td>"),e=$("<td>"+a.Title+"</td>"),f=$("<td>"+a.Year+"</td>"),g=$("<td>"+a.Genre+"</td>"),h=$("<td>"+a.imdbRating+"</td>"),i=$('<input type="button" class="btn btn-danger del_btn" value="X">');return c.append(d,e,f,g,h,i),c}var API_URL="http://www.omdbapi.com/?t=",movie,$divContain=$(".movie-container"),$addButton=$(".add"),$divTable=$(".movie-list"),FIREBASE_AUTH="https://mymdb.firebaseio.com",fb=new Firebase(FIREBASE_AUTH),favMovies;$(".doLogout").click(function(){fb.unauth(),$divTable.empty()}),$(".login form").submit(function(){var a=$('.login input[type="email"]').val(),b=$('.login input[type="password"]').val();doLogin(a,b),event.preventDefault()}),$(".doRegister").click(function(){var a=$('.login input[type="email"]').val(),b=$('.login input[type="password"]').val();fb.createUser({email:a,password:b},function(c,d){c?alert(c.toString()):(doLogin(a,b),console.log("Successfully created user account with uid:",d.uid))}),event.preventDefault()}),$(".doResetPassword").click(function(){var a=$('.login input[type="email"]').val();fb.resetPassword({email:a},function(a){a?alert(a.toString()):alert("Check your email!")})}),$(".onTempPassword form").submit(function(){var a=fb.getAuth().password.email,b=$(".onTempPassword input:nth-child(1)").val(),c=$(".onTempPassword input:nth-child(2)").val();fb.changePassword({email:a,oldPassword:b,newPassword:c},function(a){a?alert(a.toString()):fb.unauth()}),event.preventDefault()}),fb.onAuth(function(a){a&&a.password.isTemporaryPassword&&"/reset/"!==window.location.pathname?window.location="/reset":a&&!a.password.isTemporaryPassword&&"/"===window.location.pathname?(favMovies=fb.child("users/"+fb.getAuth().uid+"/movies"),favMovies.on("child_added",function(a){var b={};b[a.key()]=a.val(),userMovies(b)})):a||"/login/"===window.location.pathname||(window.location="/login/",$(".onLoggedIn").addClass("hidden")),clearLoginForm()}),$(".submit-form").submit(function(a){a.preventDefault(),movie=$(this).find('input[type!="submit"]').val();var b=API_URL+movie.split(" ").join("+");$.get(b,addMovieToDiv,"jsonp"),$addButton.show(),$(".movie_result").addClass("result_styling")}),$addButton.click(function(){movie=$("input").val();var a=API_URL+movie.split(" ").join("+");$.get(a,function(a){favMovies.push(a,function(a){console.log(a)})},"jsonp")});var $rows=$(".movie-list");$rows.on("click",".btn",function(){var a=$(this).closest(".movie_row"),b=a.attr("data-id");favMovies.child(b).set(null),a.remove(),favMovies.on("child_removed",function(){})});